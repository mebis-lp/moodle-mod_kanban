define("mod_kanban/board",["exports","core/reactive","mod_kanban/selectors","mod_kanban/exporter","mod_kanban/kanbancomponent","core/notification","core/str"],(function(_exports,_reactive,_selectors,_exporter,_kanbancomponent,_notification,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_selectors=_interopRequireDefault(_selectors),_exporter=_interopRequireDefault(_exporter),_kanbancomponent=_interopRequireDefault(_kanbancomponent);class _default extends _kanbancomponent.default{constructor(){super(...arguments),_defineProperty(this,"LOCKED_COLUMNS",1),_defineProperty(this,"LOCKED_COMPLETE",2)}static init(target){return new this({element:document.getElementById(target)})}create(){this.cmid=this.element.dataset.cmid,this.id=this.element.dataset.id}getWatchers(){return[{watch:"board:updated",handler:this._boardUpdated},{watch:"columns:created",handler:this._columnCreated},{watch:"board:deleted",handler:this._reload},{watch:"common:updated",handler:this._commonUpdated}]}async stateReady(state){this.addEventListener(this.getElement(_selectors.default.ADDCOLUMNFIRST),"click",this._addColumn),this.addEventListener(this.getElement(_selectors.default.LOCKBOARDCOLUMNS),"click",this._lockColumns),this.addEventListener(this.getElement(_selectors.default.UNLOCKBOARDCOLUMNS),"click",this._unlockColumns),this.addEventListener(this.getElement(_selectors.default.SAVEASTEMPLATE),"click",this._templateConfirm),this.addEventListener(this.getElement(_selectors.default.SHOWTEMPLATE),"click",this._showTemplate),this.addEventListener(this.getElement(_selectors.default.DELETEBOARD),"click",this._deleteConfirm),this.addEventListener(this.getElement(_selectors.default.DELETETEMPLATE),"click",this._deleteTemplateConfirm),this.addEventListener(this.getElement(_selectors.default.SHOWBOARD),"click",this._reload),this.dragdrop=new _reactive.DragDrop(this),state.common.liveupdate>0&&this._continuousUpdate(state.common.liveupdate)}_showTemplate(){window.location.href=M.cfg.wwwroot+"/mod/kanban/view.php?id="+this.reactive.state.common.id+"&boardid="+this.reactive.state.common.template}_reload(){window.location.replace(M.cfg.wwwroot+"/mod/kanban/view.php?id="+this.reactive.state.common.id)}_continuousUpdate(){setInterval((()=>{this.reactive.dispatch("getUpdates")}),1e3*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:10))}_commonUpdated(_ref){let{element:element}=_ref;this.toggleClass(0!=element.template,"mod_kanban_hastemplate")}destroy(){void 0!==this.dragdrop&&this.dragdrop.unregister(),this._reload()}_templateConfirm(){(0,_notification.saveCancel)((0,_str.get_string)("saveastemplate","mod_kanban"),(0,_str.get_string)("saveastemplateconfirm","mod_kanban"),(0,_str.get_string)("save","core"),(()=>{this._saveAsTemplate()}))}_saveAsTemplate(){this.reactive.dispatch("saveAsTemplate")}_deleteConfirm(){(0,_notification.saveCancel)((0,_str.get_string)("deleteboard","mod_kanban"),(0,_str.get_string)("deleteboardconfirm","mod_kanban"),(0,_str.get_string)("delete","core"),(()=>{this._deleteBoard()}))}_deleteTemplateConfirm(){(0,_notification.saveCancel)((0,_str.get_string)("deletetemplate","mod_kanban"),(0,_str.get_string)("deletetemplateconfirm","mod_kanban"),(0,_str.get_string)("delete","core"),(()=>{this._deleteBoard()}))}_deleteBoard(){this.reactive.dispatch("deleteBoard")}_boardUpdated(_ref2){let{element:element}=_ref2;const colcontainer=this.getElement(_selectors.default.COLUMNCONTAINER);if(void 0!==element.sequence){let sequence=element.sequence.split(",");[...colcontainer.children].forEach((node=>{node.classList.contains("mod_kanban_column")&&!sequence.includes(node.dataset.id)&&colcontainer.removeChild(node)})),[...colcontainer.children].sort(((a,b)=>sequence.indexOf(a.dataset.id)>sequence.indexOf(b.dataset.id)?1:-1)).forEach((node=>colcontainer.appendChild(node)))}this.toggleClass(element.locked,"mod_kanban_board_locked_columns"),this.toggleClass(element.hastemplate,"mod_kanban_hastemplate")}async _columnCreated(_ref3){let{element:element}=_ref3,data=Object.assign({id:element.id,title:element.title,options:element.options,sequence:element.sequence},_exporter.default.exportCapabilities(this.reactive.state)),placeholder=document.createElement("li");placeholder.setAttribute("data-id",data.id),this.getElement(_selectors.default.COLUMNCONTAINER).appendChild(placeholder);const newelement=(await this.renderComponent(placeholder,"mod_kanban/column",data)).getElement();this.getElement(_selectors.default.COLUMNCONTAINER).replaceChild(newelement,placeholder)}_addColumn(){this.reactive.dispatch("addColumn",0)}_lockColumns(){this.reactive.dispatch("lockColumns")}_unlockColumns(){this.reactive.dispatch("unlockColumns")}validateDropData(dropdata){return"column"==(null==dropdata?void 0:dropdata.type)}drop(dropdata){this.reactive.dispatch("moveColumn",dropdata.id,0)}showDropZone(){this.getElement(_selectors.default.ADDCOLUMNCONTAINER).classList.add("mod_kanban_insert")}hideDropZone(){this.getElement(_selectors.default.ADDCOLUMNCONTAINER).classList.remove("mod_kanban_insert")}}return _exports.default=_default,_exports.default}));

//# sourceMappingURL=board.min.js.map