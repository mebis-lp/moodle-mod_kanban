define("mod_kanban/board",["exports","core/reactive","mod_kanban/selectors","mod_kanban/capabilities","mod_kanban/exporter","mod_kanban/kanbancomponent","core/log","core/notification","core/str"],(function(_exports,_reactive,_selectors,_capabilities,_exporter,_kanbancomponent,_log,_notification,Str){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_selectors=_interopRequireDefault(_selectors),_capabilities=_interopRequireDefault(_capabilities),_exporter=_interopRequireDefault(_exporter),_kanbancomponent=_interopRequireDefault(_kanbancomponent),_log=_interopRequireDefault(_log),Str=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Str);class _default extends _kanbancomponent.default{constructor(){super(...arguments),_defineProperty(this,"LOCKED_COLUMNS",1),_defineProperty(this,"LOCKED_COMPLETE",2)}static init(target){return new this({element:document.getElementById(target)})}create(){this.cmid=this.element.dataset.cmid,this.id=this.element.dataset.id}getWatchers(){return[{watch:"board:updated",handler:this._boardUpdated},{watch:"columns:created",handler:this._columnCreated},{watch:"board:deleted",handler:this._reload},{watch:"common:updated",handler:this._commonUpdated}]}async stateReady(state){this.addEventListener(this.getElement(_selectors.default.ADDCOLUMNFIRST),"click",this._addColumn),1==state.capabilities.get(_capabilities.default.MANAGEBOARD).value&&(this.addEventListener(this.getElement(_selectors.default.LOCKBOARDCOLUMNS),"click",this._lockColumns),this.addEventListener(this.getElement(_selectors.default.UNLOCKBOARDCOLUMNS),"click",this._unlockColumns),this.addEventListener(this.getElement(_selectors.default.SAVEASTEMPLATE),"click",this._templateConfirm),this.addEventListener(this.getElement(_selectors.default.SHOWTEMPLATE),"click",this._showTemplate),this.addEventListener(this.getElement(_selectors.default.DELETETEMPLATE),"click",this._deleteTemplateConfirm)),this.addEventListener(this.getElement(_selectors.default.DELETEBOARD),"click",this._deleteConfirm),this.addEventListener(this.getElement(_selectors.default.SCROLLLEFT),"click",this._scrollLeft),this.addEventListener(this.getElement(_selectors.default.SCROLLRIGHT),"click",this._scrollRight),this.addEventListener(this.getElement(_selectors.default.MAIN),"scroll",this._updateScrollButtons),this.dragdrop=new _reactive.DragDrop(this),state.common.liveupdate>0&&this._continuousUpdate(state.common.liveupdate),this.toggleClass("ontouchstart"in document.documentElement,"mod_kanban_touch"),this._updateScrollButtons()}_showTemplate(){window.location.href=M.cfg.wwwroot+"/mod/kanban/view.php?id="+this.reactive.state.common.id+"&boardid="+this.reactive.state.common.template}_reload(){window.location.replace(M.cfg.wwwroot+"/mod/kanban/view.php?id="+this.reactive.state.common.id+"&userid="+this.reactive.state.common.userid)}_continuousUpdate(){setInterval((()=>{this.reactive.dispatch("getUpdates")}),1e3*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:10))}_commonUpdated(_ref){let{element:element}=_ref;this.toggleClass(0!=element.template,"mod_kanban_hastemplate")}destroy(){void 0!==this.dragdrop&&this.dragdrop.unregister(),this._reload()}_templateConfirm(){Str.get_strings([{key:"saveastemplate",component:"mod_kanban"},{key:"saveastemplateconfirm",component:"mod_kanban"},{key:"save",component:"core"}]).then((strings=>(0,_notification.saveCancel)(strings[0],strings[1],strings[2],(()=>{this._saveAsTemplate()})))).catch((error=>_log.default.debug(error)))}_saveAsTemplate(){this.reactive.dispatch("saveAsTemplate")}_deleteConfirm(){Str.get_strings([{key:"deleteboard",component:"mod_kanban"},{key:"deleteboardconfirm",component:"mod_kanban"},{key:"delete",component:"core"}]).then((strings=>(0,_notification.saveCancel)(strings[0],strings[1],strings[2],(()=>{this._deleteBoard()})))).catch((error=>_log.default.debug(error)))}_deleteTemplateConfirm(){Str.get_strings([{key:"deletetemplate",component:"mod_kanban"},{key:"deletetemplateconfirm",component:"mod_kanban"},{key:"delete",component:"core"}]).then((strings=>(0,_notification.saveCancel)(strings[0],strings[1],strings[2],(()=>{this._deleteBoard()})))).catch((error=>_log.default.debug(error)))}_deleteBoard(){this.reactive.dispatch("deleteBoard")}_boardUpdated(_ref2){let{element:element}=_ref2;const colcontainer=this.getElement(_selectors.default.COLUMNCONTAINER);if(void 0!==element.sequence){let sequence=element.sequence.split(",");[...colcontainer.children].forEach((node=>{node.classList.contains("mod_kanban_column")&&!sequence.includes(node.dataset.id)&&colcontainer.removeChild(node)})),[...colcontainer.children].sort(((a,b)=>sequence.indexOf(a.dataset.id)>sequence.indexOf(b.dataset.id)?1:-1)).forEach((node=>colcontainer.appendChild(node)))}this.toggleClass(element.locked,"mod_kanban_board_locked_columns"),this.toggleClass(element.hastemplate,"mod_kanban_hastemplate"),this._updateScrollButtons()}async _columnCreated(_ref3){let{element:element}=_ref3,data=Object.assign({id:element.id,title:element.title,options:element.options,sequence:element.sequence},_exporter.default.exportCapabilities(this.reactive.state)),placeholder=document.createElement("li");placeholder.setAttribute("data-id",data.id),this.getElement(_selectors.default.COLUMNCONTAINER).appendChild(placeholder);const newelement=(await this.renderComponent(placeholder,"mod_kanban/column",data)).getElement();this.getElement(_selectors.default.COLUMNCONTAINER).replaceChild(newelement,placeholder),this._updateScrollButtons()}_addColumn(){document.activeElement.blur(),this.reactive.dispatch("addColumn",0)}_lockColumns(){this.reactive.dispatch("lockColumns")}_unlockColumns(){this.reactive.dispatch("unlockColumns")}validateDropData(dropdata){return"column"==(null==dropdata?void 0:dropdata.type)}drop(dropdata){this.reactive.dispatch("moveColumn",dropdata.id,0)}showDropZone(){this.getElement(_selectors.default.ADDCOLUMNCONTAINER).classList.add("mod_kanban_insert")}hideDropZone(){this.getElement(_selectors.default.ADDCOLUMNCONTAINER).classList.remove("mod_kanban_insert")}_scrollLeft(){this.getElement(_selectors.default.MAIN).scrollLeft-=.75*document.querySelector(".mod_kanban_column").clientWidth}_scrollRight(){this.getElement(_selectors.default.MAIN).scrollLeft+=.75*document.querySelector(".mod_kanban_column").clientWidth}_updateScrollButtons(){let main=this.getElement(_selectors.default.MAIN);main.scrollLeft<=1?this.getElement(_selectors.default.SCROLLLEFT).style.setProperty("visibility","hidden"):this.getElement(_selectors.default.SCROLLLEFT).style.setProperty("visibility","visible"),main.clientWidth+main.scrollLeft<main.scrollWidth?this.getElement(_selectors.default.SCROLLRIGHT).style.setProperty("visibility","visible"):this.getElement(_selectors.default.SCROLLRIGHT).style.setProperty("visibility","hidden")}}return _exports.default=_default,_exports.default}));

//# sourceMappingURL=board.min.js.map